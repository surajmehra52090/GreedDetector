<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="generator" content="Greed Detector" />
  <title>Greed Detector</title>

  <meta name="theme-color" content="#FFFFFF">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="manifest" href="/manifest.json">

  <meta name="application-name" content="Greed Detector">
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="msapplication-tooltip" content="James Fenn">
  <meta name="msapplication-config" content="/ieconfig.xml">

  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="icon" sizes="16x16" href="/favicon.ico">
  <link rel="icon" sizes="24x24" href="/images/favicon-24.ico">
  <link rel="icon" sizes="32x32" href="/images/favicon-32.ico">
  <link rel="icon" sizes="48x48" href="/images/favicon-48.ico">
  <link rel="icon" sizes="64x64" href="/images/favicon-48.ico">

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Greed Detector">
  <link rel="apple-touch-icon-precomposed" href="/images/favicon-152.png">

  <link href="https://fonts.googleapis.com/css?family=Miriam+Libre" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet">

  <style>
    #progressBg, #progressFg {
      width: 100%;
      height: 28px;
      position: fixed;
    }

    #progressText {
      color: #00BF62;
      mix-blend-mode: luminosity;
      font-weight: bold;
      position: fixed;
      margin: 3px 12px;
      height: 22px;
    }

    #progressBg {
      background-color: rgba(0, 0, 0, 0.15);
    }

    #progressFg {
      background-color: #000000;
      width: 0px;
      transition: width .25s;
	    -moz-transition: width .25s;
	    -webkit-transition: width .25s;
    }

    #questions, #results {
      margin-top: calc(5vh + 50px);
    }

    #questions>form {
      padding: 8px 0;
    }

    #questions>button {
      float: right;
    }
  </style>
</head>
<body>
  <header>
    <h1>Are you greedy?</h1>
  </header>
  <div id="greedEstimate">
    <div id="progressBg"></div>
    <div id="progressFg"></div>
    <p id="progressText">Estimated greed: <span id="progressTextPercent">50%</span></p>
  </div>
  <main>
    <div id="questions" style="display: block;">
      <h2 id="question">Question</h2>
      <form id="answers" action="">
        <p>
          <input id="0" type="radio" name="answer">
          <label for="0">Answer</label>
        </p>
        <p>
          <input id="1" type="radio" name="answer">
          <label for="1">Answer</label>
        </p>
      </form>
      <button id="next" onclick="nextQuestion();">NEXT</button>
    </div>
    <div id="results" style="display: none;">
      <h1>Results</h1>
      <h2 id="greedyboii">I think that you are hot dogs, not legs.</h2>
      <p>
        You scored a greed rating of <span id="rating">9000</span> out of <span id="totalRating">over 9000</span>,
        or <span id="percentRating">infinite percent</span> greediness. Higher scores are worse. Unless you're a
        horrible person, in which case they're better... for you.
      </p>
      <p>Here is a list of the questions and how they affected your greed rating:</p>
      <div id="greedQuestions"></div>
      <br>
      <h2>Statistics</h2>
      <p>These are a few statistics showing general trends among people that have taken this quiz so far.</p>
      <div id="greedyCatsChart" class="chart noanim"></div>
      <div id="greedyDogsChart" class="chart noanim"></div>
    </div>
  </main>

  <script src="js/game.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
  var greedEstimate = document.getElementById("greedEstimate");
  var greedProgress = document.getElementById("progressFg");
  var greedPercentProgress = document.getElementById("progressTextPercent");
  var questionContainer = document.getElementById("questions");
  var questionName = document.getElementById("question");
  var answerContainer = document.getElementById("answers");
  var nextButton = document.getElementById("next");
  var resultContainer = document.getElementById("results");
  var greedName = document.getElementById("greedyboii");
  var greedRating = document.getElementById("rating");
  var greedTotalRating = document.getElementById("totalRating");
  var greedPercentRating = document.getElementById("percentRating");
  var greedQuestions = document.getElementById("greedQuestions");
  var greedyCatsChart = document.getElementById("greedyCatsChart");
  var greedyDogsChart = document.getElementById("greedyDogsChart");

  google.charts.load('current', {'packages':['corechart']});

  function setQuestion(question) {
    this.question = question;
    questionName.innerHTML = question.name;
    var answers = "";
    for (var i = 0; i < question.options.length; i++) {
      answers += getAnswerHTML(question.options[i].name);
    }
    answerContainer.innerHTML = answers;
  }

  function getAnswerHTML(name) {
    return "<p onclick=\"setAnswer(\'" + name + "\');\"><input id=\"" + name + "\" type=\"radio\" name=\"answer\"></input><label for=\"" + name + "\">" + name + "</label></p>";
  }

  function onGreedChange(greed) {
    var percent = ((totalGreed + greed) / (2 * totalGreed)) * 100;
    greedProgress.style.width = percent + "%";
    greedPercentProgress.innerHTML = Math.round(percent) + "%";
  }

  function onFinish() {
    question = null;
    greedRating.innerHTML = totalGreed + greed;
    greedPercentRating.innerHTML = Math.round(((totalGreed + greed) / (2 * totalGreed)) * 100) + "%";

    if (greed > 0) {
      greedName.innerHTML = "Ha! Your plans have been foiled, you slave to the unpleasant habitual avarice of humanity.";
    } else {
      greedName.innerHTML = "Believe it or not, you aren\'t actually that greedy. I know, weird, right? It\'s almost like you\'re a decent person or something.";
    }

    var questionsHTML = "";
    for (var i = 0; i < questions.length; i++) {
      var answersHTML = "";
      for (var i2 = 0; i2 < questions[i].options.length; i2++) {
        if (questions[i].options[i2].selected) {
          if (questions[i].options[i2].value != 0) {
            answersHTML += "<li>" + questions[i].options[i2].name + " - " + (questions[i].options[i2].value > 0 ? "increased" : "decreased") + " your greediness by " + Math.abs(questions[i].options[i2].value) + "</li>";
          } else {
            answersHTML += "<li>" + questions[i].options[i2].name + " - didn\'t affect your score</li>";
          }
        } else answersHTML += "<li>" + questions[i].options[i2].name + "</li>";
      }
      questionsHTML += "<div class=\"stat\">";
      questionsHTML += "<h4>" + questions[i].name + "</h4><ul>" + answersHTML + "</ul>";
      if (questions[i].why)
        questionsHTML += "<a onclick=\"document.getElementById(\'why" + questions[i].id + "\').style.display = \'block\';\">Why ask this question?</a><p id=\"why" + questions[i].id + "\" style=\"display: none;\" class=\"smalltext\">" + questions[i].why + "</p>";
      questionsHTML += "</div>";
    }
    greedQuestions.innerHTML = questionsHTML;

    questionContainer.style.display = "none";
    greedEstimate.style.display = "none";
    resultContainer.style.display = "block";

    var items = saveResult();
    if (items) {
      addGreedyPreferenceChart(items, "dogsVsCats", "Cats", greedyCatsChart);
      addGreedyPreferenceChart(items, "dogsVsCats", "Dogs", greedyDogsChart);
    }
  }

  function addGreedyPreferenceChart(items, questionId, optionName, element) {
    var greedy = 0;
    var notGreedy = 0;
    for (var i = 0; i < items.length; i++) {
      if (getOptionByName(getQuestionById(items[i].questions, questionId).options, optionName).selected) {
        if (items[i].greed > totalGreed)
          greedy++;
        else notGreedy++;
      }
    }

    new google.visualization.PieChart(element).draw(
      google.visualization.arrayToDataTable([
        ['Task', 'People That Like ' + optionName],
        ['Greedy', greedy],
        ['Not Greedy', notGreedy]
      ]),
      {
        "title": "Are people that like " + optionName.toLowerCase() + " greedy?",
        "width": 500,
        "height": 400
      }
    );
  }

  /*function addPreferenceGreedyChart(items, questionId, element) {
    var options = getQuestionById(items[0].questions, questionId).options;
    var array = [
      ['Task', 'Do Greedy People Like ' + options[0].name]
    ]

    for (var i = 0; i < options.length; i++) {
      array.push([options[i].name, 0]);
    }

    for (var i = 0; i < items.length; i++) {
      if (items[i].greed > totalGreed) {
        var question = getQuestionById(items[i].questions, questionId);
        for (var i2 = 0; i2 < question.options.length; i2++) {
          if (question.options[i2].selected) {
            array[i2][1]++;
            break;
          }
        }
      }
    }

    new google.visualization.PieChart(element).draw(
      google.visualization.arrayToDataTable(array),
      {
        "title": "Do greedy people like " + options[0].name.toLowerCase() + "?",
        "width": 500,
        "height": 400
      }
    );
  }*/ //TODO: doesn't work, fix later

  function getQuestionById(questions, id) {
    for (var i = 0; i < questions.length; i++) {
      if (questions[i].id == id)
        return questions[i];
    }
  }

  function getOptionByName(options, name) {
    for (var i = 0; i < options.length; i++) {
      if (options[i].name == name)
      return options[i];
    }
  }

  greedTotalRating.innerHTML = totalGreed * 2;
  nextQuestion();
  onGreedChange(fakeGreed);
  </script>
</body>
</html>
